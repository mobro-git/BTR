---
title: "BTR Results Overview"
output:
  html_document:
    toc: yes
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    theme: spacelab
date: "`r Sys.time()`"
---

```{r,echo = FALSE, results = "show", warning = FALSE, message = FALSE, error = FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "show", warning = FALSE, message = FALSE, error = FALSE, 
                      fig.align = "center", fig.width = 9, fig.height = 5)
```

```{r}
library(targets)
library(tarchetypes)
tar_source()
```

```{r}
tar_load(
  c(
    config,
    settings,
    data_long_clean,
    projections_all_sm,
    figmap_nrgco2_stackbar,
    figmap_nrgco2_timeseries,
    figmap_nrgco2_diffbar
    )
  )
```

```{r}
source('packages.R')
source("scripts/theming.R")
```

# Emissions

## Energy CO2 Emissions by Sector {.tabset}

### Model

```{r}
model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 9, "United States", scenario_rename = TRUE,
            level_var = c("Buildings", "Industry", "Transportation", "Supply", "Total Energy"))
model
```

### Sector

```{r}
sector = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 19, "United States", scenario_rename = TRUE)
sector
```

### Stats

```{r}
figure_subset_df <- get_figure_subset_df(figmap_nrgco2_stackbar,19)
figure_subset_vars <- unique(figure_subset_df$variable)
nrgco2_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 19, figure_subset_vars, data_long_clean, config)

buildings_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 19, "Emissions|CO2|Energy|Demand|Buildings", data_long_clean, config)
industry_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 19, "Emissions|CO2|Energy|Demand|Industry", data_long_clean, config)
transportation_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 19, "Emissions|CO2|Energy|Demand|Transportation", data_long_clean, config)
```

In the "With Measures" scenarios, Energy CO~2~ emissions reductions range by model from 2020 to 2040:

-   GCAM: `r nrgco2_value_list$GCAM`%
-   OP-NEMS: `r nrgco2_value_list$"OP-NEMS"`%
-   USREP-ReEDS: `r nrgco2_value_list$"USREP-ReEDS"`%

By sector, emissions reductions are estimate to change from 2020 to 2040:

-   Buildings:
    -   GCAM: `r buildings_value_list$GCAM`%
    -   OP-NEMS: `r buildings_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r buildings_value_list$"USREP-ReEDS"`%
-   Industry:
    -   GCAM: `r industry_value_list$GCAM`%
    -   OP-NEMS: `r industry_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r industry_value_list$"USREP-ReEDS"`%
-   Transportation:
    -   GCAM: `r transportation_value_list$GCAM`%
    -   OP-NEMS: `r transportation_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r transportation_value_list$"USREP-ReEDS"`%

## Energy CO2 Emissions by Fuel {.tabset}

### Model

```{r}
model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 30, "United States")
model
```

### Fuel

```{r}
sector = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 24, "United States", scenario_rename = TRUE)
sector
```

### Stats 

```{r}
figure_subset_df <- get_figure_subset_df(figmap_nrgco2_stackbar,24)
figure_subset_vars <- unique(figure_subset_df$variable)
nrgco2_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 24, figure_subset_vars, data_long_clean, config)

buildings_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 24, "Emissions|CO2|Energy|Coal", data_long_clean, config)
industry_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 24, "Emissions|CO2|Energy|Gas", data_long_clean, config)
transportation_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 24, "Emissions|CO2|Energy|Oil", data_long_clean, config)
```

# Energy Consumption

## Final Energy by Fuel {.tabset}

### Fuel

```{r}
fuel = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 14, "United States", scenario_rename = TRUE)
fuel
```

### Model

```{r}
Fuel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 1, "United States", scenario_rename = TRUE)
Fuel
```

### Model - Zoom

```{r}
Fuel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 24, "United States", scenario_rename = TRUE)
Fuel
```

### Stats 

```{r}
figure_subset_df <- get_figure_subset_df(figmap_nrgco2_stackbar,14)
figure_subset_vars <- unique(figure_subset_df$variable)
final_energy_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 14, figure_subset_vars, data_long_clean, config)

fe_coal_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 14, "Final Energy|Coal", data_long_clean, config)
fe_electricity_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 14, "Final Energy|Electricity", data_long_clean, config)
fe_gas_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 14, "Final Energy|Gas", data_long_clean, config)
fe_oil_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 14, "Final Energy|Oil", data_long_clean, config)
```

Energy consumption is estimated to change from 2020 to 2040:

-   GCAM: `r final_energy_value_list$GCAM`%
-   OP-NEMS: `r final_energy_value_list$"OP-NEMS"`%
-   USREP-ReEDS: `r final_energy_value_list$"USREP-ReEDS"`%

By fuel-type, energy consumption is estimated to change from 2020 to 2040:

-   Coal:
    -   GCAM: `r fe_coal_value_list$GCAM`%
    -   OP-NEMS: `r fe_coal_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_coal_value_list$"USREP-ReEDS"`%
-   Electricity:
    -   GCAM: `r fe_electricity_value_list$GCAM`%
    -   OP-NEMS: `r fe_electricity_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_electricity_value_list$"USREP-ReEDS"`%
-   Gas:
    -   GCAM: `r fe_gas_value_list$GCAM`%
    -   OP-NEMS: `r fe_gas_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_gas_value_list$"USREP-ReEDS"`%
-   Oil:
    -   GCAM: `r fe_oil_value_list$GCAM`%
    -   OP-NEMS: `r fe_oil_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_oil_value_list$"USREP-ReEDS"`%

## Final Energy by Sector {.tabset}

### Model

```{r}
Sector = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 2, "United States", scenario_rename = TRUE,
                     level_var = c("Buildings", "Industry", "Transportation", "Total Energy"))
Sector
```

### Sector

```{r}
sector = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 17, "United States", scenario_rename = TRUE)
sector
```

### Stats

```{r}
fe_buildings_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 17, "Final Energy|Buildings", data_long_clean, config)
fe_industry_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 17, "Final Energy|Industry", data_long_clean, config)
fe_transportation_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 17, "Final Energy|Transportation", data_long_clean, config)
```

By sector, energy consumption is estimated to change from 2020 to 2040:

-   Buildings:
    -   GCAM: `r fe_buildings_value_list$GCAM`%
    -   OP-NEMS: `r fe_buildings_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_buildings_value_list$"USREP-ReEDS"`%
-   Industry:
    -   GCAM: `r fe_industry_value_list$GCAM`%
    -   OP-NEMS: `r fe_industry_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_industry_value_list$"USREP-ReEDS"`%
-   Transportation:
    -   GCAM: `r fe_transportation_value_list$GCAM`%
    -   OP-NEMS: `r fe_transportation_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r fe_transportation_value_list$"USREP-ReEDS"`%

## Final Energy by Sector 

### Buildings {.tabset}

#### Model

```{r}
Buildings_bymodel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 17, "United States", scenario_rename = TRUE,
                                level_var = c("Coal", "Gas", "Oil", 'Electricity',"Total Energy"))
Buildings_bymodel
```

#### Buildings

```{r}
Buildings = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 8, "United States", scenario_rename = TRUE)
Buildings
```

#### Residential by Model

```{r}
Buildings_bymodel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 31, "United States", scenario_rename = TRUE)
Buildings_bymodel
```

#### Residential

```{r}
Buildings = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 25, "United States", scenario_rename = TRUE)
Buildings
```

#### Commercial by Model

```{r}
Buildings_bymodel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 32, "United States", scenario_rename = TRUE)
Buildings_bymodel
```

#### Commercial

```{r}
Buildings = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 26, "United States", scenario_rename = TRUE)
Buildings
```

### Industry {.tabset}

#### Model

```{r}
Industry_bymodel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 18, "United States", scenario_rename = TRUE)
Industry_bymodel
```

#### Industry

```{r}
Industry = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 9, "United States", scenario_rename = TRUE)
Industry
```

### Transportation {.tabset}
TODO: Add facets vehicle type sales share/stock share, tabs freight/passenger

#### Model

```{r}
Transportation_bymodel = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 19, "United States", scenario_rename = TRUE)
Transportation_bymodel
```

#### Transportation

```{r}
Transportation = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 12, "United States", scenario_rename = TRUE)
Transportation
```

## Percent Electricity

```{r}
Percent_Electricity = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 14, "United States", scenario_rename = TRUE,
                                  level_var = c("Buildings", "Industry", "Transportation","Total Electricity"))
Percent_Electricity
```

# Energy Production

## Secondary Energy {.tabset}

### Model

```{r, fig.width=12}
Model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 8, "United States", scenario_rename = TRUE)
Model
```

### Model - Zoom

```{r}
Model_zoom = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 25, "United States", scenario_rename = TRUE)
Model_zoom

```

### Fuel

```{r}
Fuel = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 15, "United States", scenario_rename = TRUE)
Fuel
```

## Electricity Production 

### Generation {.tabset}

#### Model

```{r, fig.width=12}
elec_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 15, "United States", scenario_rename = TRUE,
                         level_var = c("Coal", "Gas", "Oil","Solar", "Wind", "Total Electricity"))
elec_model

```

#### Model - Zoom

```{r, fig.width=12}
elec_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 27, "United States", scenario_rename = TRUE,
                         level_var = c("Coal", "Gas", "Oil","Solar", "Wind", "Total Electricity"))
elec_model

```

#### Generation

```{r}
elec_gen = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 13, "United States", scenario_rename = TRUE)
elec_gen
```

#### Stats

```{r}
figure_subset_df <- get_figure_subset_df(figmap_nrgco2_stackbar,13)
figure_subset_vars <- unique(figure_subset_df$variable)
se_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, figure_subset_vars, data_long_clean, config)
se_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity", data_long_clean, config)


se_coal_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity|Coal", data_long_clean, config)
se_gas_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity|Gas", data_long_clean, config)
se_oil_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity|Oil", data_long_clean, config)
se_solar_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity|Solar", data_long_clean, config)
se_wind_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 13, "Secondary Energy|Electricity|Wind", data_long_clean, config)

```

### Capacity {.tabset}

#### Model

```{r, fig.width=12}
elec_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 16, "United States", scenario_rename = TRUE,
                         level_var = c("Coal", "Gas", "Oil","Solar", "Wind", "Storage", "Total Electricity"))
elec_model

```

#### Model - Zoom

```{r}
elec_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 26, "United States", scenario_rename = TRUE,
                         level_var = c("Coal", "Gas", "Oil","Solar", "Wind", "Storage", "Total Electricity"))
elec_model
```

#### Capacity

```{r}
Capacity = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 3, "United States", scenario_rename = TRUE)
Capacity
```

#### Stats

```{r}
figure_subset_df <- get_figure_subset_df(figmap_nrgco2_stackbar,3)
figure_subset_vars <- unique(figure_subset_df$variable)
cap_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, figure_subset_vars, data_long_clean, config)

cap_coal_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Coal", data_long_clean, config)
cap_gas_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Gas", data_long_clean, config)
cap_oil_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Oil", data_long_clean, config)
cap_solar_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Solar", data_long_clean, config)
cap_storage_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Storage Capacity", data_long_clean, config)
cap_wind_value_list <- get_value_list_from_var_list(figmap_nrgco2_stackbar, 3, "Capacity|Electricity|Wind", data_long_clean, config)
```

Electricity capacity is estimated to increase from 2020 to 2040:

-   GCAM: `r cap_value_list$GCAM`%
-   OP-NEMS: `r cap_value_list$"OP-NEMS"`%
-   USREP-ReEDS: `r cap_value_list$"USREP-ReEDS"`%

By technology, electricity capacity is estimated to change from 2020 to 2040:

-   Coal:
    -   GCAM: `r cap_coal_value_list$GCAM`%
    -   OP-NEMS: `r cap_coal_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r cap_coal_value_list$"USREP-ReEDS"`%
-   Gas:
    -   GCAM: `r cap_gas_value_list$GCAM`%
    -   OP-NEMS: `r cap_gas_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r cap_gas_value_list$"USREP-ReEDS"`%
-   Oil:
    -   GCAM: `r cap_oil_value_list$GCAM`%
    -   OP-NEMS: `r cap_oil_value_list$"OP-NEMS"`%
-   Solar:
    -   GCAM: `r cap_solar_value_list$GCAM`%
    -   OP-NEMS: `r cap_solar_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r cap_solar_value_list$"USREP-ReEDS"`%
-   Storage:
    -   OP-NEMS: `r cap_storage_value_list$GCAM`%
    -   USREP-ReEDS: `r cap_storage_value_list$"OP-NEMS"`%
-   Wind:
    -   GCAM: `r cap_wind_value_list$GCAM`%
    -   OP-NEMS: `r cap_wind_value_list$"OP-NEMS"`%
    -   USREP-ReEDS: `r cap_wind_value_list$"USREP-ReEDS"`%

## Combustion {.tabset}

### Generation

```{r}
elec_gen = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 6, "United States", scenario_rename = TRUE)
elec_gen
```

### Generation by Model

```{r, fig.width=12}
gen_by_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 20, "United States", scenario_rename = TRUE)
gen_by_model
```

### Generation by Model - Zoom

```{r}
gen_by_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 28, "United States", scenario_rename = TRUE)
gen_by_model
```

### Capacity

```{r}
Capacity = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 4, "United States", scenario_rename = TRUE)
Capacity
```

### Capacity by Model

```{r, fig.width=12}
cap_by_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 22, "United States", scenario_rename = TRUE)
cap_by_model
```

### Capacity by Model - Zoom

```{r}
cap_by_model = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 29, "United States", scenario_rename = TRUE)
cap_by_model
```

## Non-Combustion {.tabset}

### Generation

```{r}
elec_gen = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 7, "United States", scenario_rename = TRUE)
elec_gen
```

### Generation by Model

```{r}
gen_by_model_nc = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 23, "United States", scenario_rename = TRUE)
gen_by_model_nc
```

### Capacity

```{r}
Capacity_nc = print_graph("stacked_bar", config, data_long_clean, figmap_nrgco2_stackbar, 5, "United States", scenario_rename = TRUE)
Capacity_nc
```

### Capacity by Model

```{r}
cap_by_model_nc = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 21, "United States", scenario_rename = TRUE)
cap_by_model_nc
```


------------------------------------------------------------------------

# Model Comparision

## Reference Model: {.tabset}

### GCAM

```{r}
diff_from_gcam = print_graph("diff_bar", config, data_long_clean, figmap_nrgco2_diffbar, 23, "United States", scenario_rename = TRUE)
diff_from_gcam
```

### OP-NEMS

```{r}
diff_from_nems = print_graph("diff_bar", config, data_long_clean, figmap_nrgco2_diffbar, 25, "United States", scenario_rename = TRUE)
diff_from_nems
```

### USREP-ReEDS

```{r}
diff_from_usrep = print_graph("diff_bar", config, data_long_clean, figmap_nrgco2_diffbar, 24, "United States", scenario_rename = TRUE)
diff_from_usrep
```

## Input Assumptions {.tabset}

### Population

```{r}
pop = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 12, "United States", scenario_rename = TRUE)
pop
```

### GDP

```{r}
gdp = print_graph("time_series", config, data_long_clean, figmap_nrgco2_timeseries, 13, "United States", scenario_rename = TRUE)
gdp
```

# Ad-hoc tables/figs

Buildings and electricity emissions reductions in 2040 compared to 2005

```{r}
get_value_breakout <- function(data_long_clean, var_list, config) {
data_wm_usa <- data_long_clean %>% filter(scenario == 'wm',
                                             region == 'United States')

var_df <- data_wm_usa %>% filter(variable %in% var_list)

var_df_clean <- var_df %>%
  select(model, year, variable, value) %>%
  filter(year %in% config$fives_sumtab) %>%
  distinct() %>%
  mutate(across(where(is.numeric), round, 1))
return(var_df_clean)
}

var_list <- c('Emissions|CO2|Energy|Demand|Buildings',
              'Emissions|CO2|Energy|Supply|Electricity')

be_df <- get_value_breakout(data_long_clean, var_list, config)
be_df2 = be_df %>% 
  spread(year,value) %>% 
  group_by(variable) %>% 
  rename(base ="2005",
         target = "2040") %>% 
  mutate(reduction =1 - (target/max(base, na.rm = "yes"))) %>% 
  ungroup() %>% 
  filter(model != "EPA-GHGI") %>% 
  select(model,variable,reduction) %>% 
  spread(model,reduction)

grid.table(be_df2)
```

Share of fuel usage in Residential Buildings

```{r}
var_list <-  c('Final Energy|Buildings|Residential|Electricity',
               'Final Energy|Buildings|Residential|Gas',
               'Final Energy|Buildings|Residential')

br_df <- get_value_breakout(data_long_clean, var_list, config)

br_df2 = br_df %>%
  filter(variable != "Final Energy|Buildings|Residential") %>% 
  left_join(br_df %>% 
              filter(variable == "Final Energy|Buildings|Residential") %>%
              select(-variable) %>% 
              rename(total = value)) %>% 
  mutate(Share = value/total) %>% 
  select(-value,-total) %>% 
  filter(year == 2040) %>% 
  spread(model,Share)

grid.table(br_df2)
```
Share of fuel usage in Commercial Buildings
```{r}
var_list <-  c('Final Energy|Buildings|Commercial|Electricity',
               'Final Energy|Buildings|Commercial|Gas',
               'Final Energy|Buildings|Commercial')

bc_df <- get_value_breakout(data_long_clean, var_list, config)

bc_df2 = bc_df %>%
  filter(variable != "Final Energy|Buildings|Commercial") %>% 
  left_join(bc_df %>% 
              filter(variable == "Final Energy|Buildings|Commercial") %>%
              select(-variable) %>% 
              rename(total = value)) %>% 
  mutate(Share = value/total) %>% 
  select(-value,-total) %>% 
  filter(year == 2040) %>% 
  spread(model,Share)

grid.table(bc_df2)
```

Share of Wind and Solar in elec gen in 2040

```{r}
df <- figmap_nrgco2_stackbar %>% filter(figure_no == 13)

var_list <- df$variable

eg_df <- get_value_breakout(data_long_clean, var_list, config)
  
```

```{r}
var_list <- c('Secondary Energy|Electricity|Wind','Secondary Energy|Electricity|Solar','Secondary Energy|Electricity')
sw_df <- get_value_breakout(data_long_clean, var_list, config)

sw_df2 = sw_df %>% 
  filter(variable %in% c('Secondary Energy|Electricity|Wind','Secondary
                         Energy|Electricity|Solar')) %>% 
  group_by(model,year) %>% 
  summarise(value = sum(value)) %>% 
  left_join(sw_df %>% 
              filter(variable == 'Secondary Energy|Electricity') %>% 
              select(-variable) %>% 
              rename(total = value)) %>% 
  mutate(Share = value/total) %>% 
  select(-value,-total) %>% 
  filter(year == 2040) %>% 
  spread(model,Share)

grid.table(sw_df2)
```

Reduction in coal to electricity in 2040 compared to model's 2020
```{r}
var_list <- 'Secondary Energy|Electricity|Input|Coal'

pec_df <- get_value_breakout(data_long_clean,var_list, config)
pec_df2 = pec_df %>% 
  spread(year, value) %>% 
  rename(base ="2020",
         target = "2040") %>% 
  mutate(reduction =1 - (target/base)) %>% 
  select(model,variable,reduction) %>% 
  spread(model,reduction)

grid.table(pec_df2)
```

Vehicle sales share in 2040
```{r}
var_list <- c("Energy Service|Transportation|Passenger|BEV|Sales Share",
              "Energy Service|Transportation|Passenger|PHEV|Sales Share",
              "Energy Service|Transportation|Passenger|ICE|Sales Share")

vs_df <- get_value_breakout(data_long_clean,var_list, config)

vs_df2 = vs_df %>% 
  filter(year ==2040) %>% 
  spread(model,value) 

grid.table(pec_df2)
  
```

