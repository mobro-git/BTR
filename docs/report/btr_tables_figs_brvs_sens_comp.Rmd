---
pagetitle: "2024 Biennial Transparency Report Projections Chapter: Historical and Projected GHG Tables & Figures"
output:
  html_document:
    number_sections: false
    highlight: tango
    fontsize: 12
    fig_caption: false
    toc: yes
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    theme: spacelab
params:
  mode: "interactive"
---

```{r,echo = FALSE, results = "show", warning = FALSE, message = FALSE, error = FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "show", warning = FALSE, message = FALSE, error = FALSE, fig.align = "center", fig.width = 9, fig.height = 7)


``` 

```{r}
source('packages.R')
library(targets)
library(tarchetypes)
tar_source()
source("scripts/theming.R")

```

```{r}

tar_load(
  c(
    config,
    settings,
    data_long_clean,
    projections_all_sm,
    total_gross_emissions,
    ghgi_comp_tab,
    projections_ghgi,
    past_proj,
    kaya_comparison50
    )
  )

projections_all_sm <- projections_all_sm %>%
  mutate(grouping = case_when(grouping == "wm" ~ "wm_sens",
                              TRUE~grouping))
  


```

# BTR Tables and Figures: BRVS & BTR Sensitivities Comparison

## Value Summary Tables {.tabset}

### Gas

```{r gas summary}
gas_df <- create_summary_table('gas','wm_sens', projections_all_sm, config, settings)
gas_table <- create_html_table(gas_df, 'Gas', settings)
gas_table_merged <- create_html_table_merged(gas_df, 'Gas', settings)

gas_table_merged
```


### Sector

```{r sector summary}
sector_df <- create_summary_table('usproj_sector', 'wm_sens', projections_all_sm, config, settings)
sector_table <- create_html_table(sector_df, 'Sector', settings)
sector_table_merged <- create_html_table_merged(sector_df, 'Sector', settings)

sector_table_merged
```

### % Change: Gas

```{r, pct change by gas}
pct_change_table_gas <- create_pct_change_table('gas', 'wm_sens', projections_all_sm, config, settings)
pct_change_html_gas_merged <- create_html_table_merged_pct_change(pct_change_table_gas, 'Gas', settings)

pct_change_html_gas_merged
```

### % Change: Sector

```{r, pct change by sector}
pct_change_table_sector <- create_pct_change_table('usproj_sector', 'wm_sens', projections_all_sm, config, settings)
pct_change_html_sector_merged <- create_html_table_merged_pct_change(pct_change_table_sector, 'Sector', settings)

pct_change_html_sector_merged
```

## Net-GHG Emissions {.tabset}

### BR:VS - BTR Model Subset

```{r}
brvs_tne <- read_csv("data-extra/BR Voluntary Supplement 2023/brvs_totalnetemissions.csv")

```


```{r}
fig <- br_project_brvs_sens(projections_ghgi, brvs_tne, config, settings, brvs_btr_subset = TRUE)

fig
```

### BR:VS - All Models

```{r}
fig <- br_project_brvs_sens(projections_ghgi, brvs_tne, config, settings, brvs_btr_subset = FALSE)

fig
```


## Value Summary Tables

### 


## Kaya BR5:VS Comparison

```{r}
kaya_brvs(kaya_comparison50, data_long_clean, config, settings)
```

## GDP-Breakout, BR5:VS Comparison

```{r}
fig <- gdp_breakout(data_long_clean, config)

fig
```


# Sector Analysis {.tabset}

## Buildings {.tabset}

### All Models

```{r}
brvs_sectors <- read_csv("data-extra/BR Voluntary Supplement 2023/brvs_sectors.csv")
```


```{r}
buildings <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Buildings|Total", brvs_btr_subset = FALSE, brvs_sectors, ghgi_comp_tab, config, settings, data_long_clean)

buildings
```

### BTR Subset

```{r}
buildings <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Buildings|Total", brvs_btr_subset = TRUE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

buildings
```

## Electricity {.tabset}

### All Models

```{r}
electricity <- brvs_sens_sectors("Emissions|CO2|Energy|Supply|Electricity", brvs_btr_subset = FALSE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

electricity
```

### BTR Subset

```{r}
electricity <- brvs_sens_sectors("Emissions|CO2|Energy|Supply|Electricity", brvs_btr_subset = TRUE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

electricity
```

## Transportation {.tabset}

### All Models

```{r}
transportation <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Transportation|Total", brvs_btr_subset = FALSE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

transportation
```

### BTR Subset

```{r}
transportation <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Transportation|Total", brvs_btr_subset = TRUE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

transportation
```

## Industry {.tabset}

### All Models

```{r}
industry <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Industry and Fuel Production|Total", brvs_btr_subset = FALSE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

industry
```

### BTR Subset

```{r}
industry <- brvs_sens_sectors("Emissions|CO2|Energy|Demand|Industry and Fuel Production|Total", brvs_btr_subset = TRUE, brvs_sectors, ghgi_comp_tab, config, settings,data_long_clean)

industry
```

