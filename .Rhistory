summary_total_gross <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name,year) %>%
summarise(cat_sum = sum(cat_sum),.groups='drop') %>%
mutate(pct_change_05 = (cat_sum/cat_sum[year==2005]-1)) %>%
mutate(pct_change_05 = round(pct_change_05,2)) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
unique(projections_all_sm$gas)
unique(projections_all_sm$usproj_sector)
category
grouping
col_order <- c('category','year','low','high')
summary <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj TODO
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
add_pct_change_05() %>%
select(!cat_sum)
summary_total_gross <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name,year) %>%
summarise(cat_sum = sum(cat_sum),.groups='drop') %>%
mutate(pct_change_05 = (cat_sum/cat_sum[year==2005]-1)) %>%
mutate(pct_change_05 = round(pct_change_05,2)) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
summary_total_net <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
group_by(proj_name,year) %>%
summarise(cat_sum = sum(cat_sum),.groups='drop') %>%
mutate(pct_change_05 = (cat_sum/cat_sum[year==2005]-1)) %>%
mutate(pct_change_05 = round(pct_change_05,2)) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Net Emissions') %>%
select(all_of(col_order))
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5)
processed_datasets <- list()
for(gas in config$gas_order){
cat_pct_change <- summary %>%
filter(category == gas) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_pct_change
}
pct_change_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_pct_change <- summary %>%
filter(category == sector) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_pct_change
}
pct_change_table_df <- bind_rows(processed_datasets)
}
pct_change_table_df_high_low <- create_high_low_df(pct_change_table_df, config)
pct_change_table_df_high_low <- pct_change_table_df_high_low[order_index,]
View(pct_change_table_df_high_low)
total_gross_emissions_high_low <- create_high_low_df(summary_total_gross, config)
total_net_emissions_high_low <- create_high_low_df(summary_total_net, config)
summary_lulucf_sink <- summary %>% filter(category == 'LULUCF Sink') %>%
group_by(year) %>%
mutate(low = min(pct_change_05),
high = max(pct_change_05)) %>%
select(category, year, low, high) %>%
distinct()
lulucf_sink_high_low <- create_high_low_df(summary_lulucf_sink, config)
proj_col_order <- c('2025_low',
'2025_high',
'2030_low',
'2030_high',
'2035_low',
'2035_high',
'2040_low',
'2040_high')
final_summary_table <- pct_change_table_df_high_low %>%
rbind(total_gross_emissions_high_low) %>%
rbind(lulucf_sink_high_low) %>%
rbind(total_net_emissions_high_low) %>% select(category,all_of(proj_col_order))
rownames(final_summary_table) <- NULL
final_summary_table_100 <- final_summary_table %>% mutate_if(is.numeric, ~ .*100)
View(final_summary_table_100)
tar_make(results_overview)
tar_invalidate(everything())
tar_make()
tar_load(c(projections_all_sm, config))
gas_df <- create_summary_table('gas','wm', projections_all_sm, config)
tar_source()
gas_df <- create_summary_table('gas','wm', projections_all_sm, config)
sector_df <- create_summary_table('usproj_sector', 'wm', projections_all_sm, config)
gas_table <- create_html_table(gas_df, 'Gas',config)
gas_table
category = 'gas'
grouping = 'wm'
col_order <- c('category','year','low','high')
summary <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop')
summary_total_gross <- summary %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
summary_total_net <- summary %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Net Emissions') %>%
select(all_of(col_order))
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5) # added NF3
processed_datasets <- list()
for(gas in config$gas_order){
cat_summary <- summary %>%
filter(category == gas) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_summary <- summary %>%
filter(category == sector) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
}
summary_table_df_high_low <- create_high_low_df(summary_table_df, config)
summary_table_df_high_low <- summary_table_df_high_low[order_index,]
View(summary_table_df_high_low)
View(summary_table_df)
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5) # added NF3
processed_datasets <- list()
for(gas in config$gas_order){
cat_summary <- summary %>%
filter(category == gas) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_summary <- summary %>%
filter(category == sector) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
}
?gsub
projections_all_sm_v1 <- projections_ghgi %>%
group_by(proj_name, grouping, gas, usproj_sector, year) %>%
summarise(sum = sum(value),.groups='drop') %>%
gsub('IPPU', 'Industrial Processes')
col_order <- c('category','year','low','high')
summary <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop')
summary_total_gross <- summary %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
summary_total_net <- summary %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Net Emissions') %>%
select(all_of(col_order))
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5) # added NF3
processed_datasets <- list()
for(gas in config$gas_order){
cat_summary <- summary %>%
filter(category == gas) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_summary <- summary %>%
filter(category == sector) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
}
View(summary_table_df)
category = 'usproj_sector'
col_order <- c('category','year','low','high')
summary <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop')
summary_total_gross <- summary %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
summary_total_net <- summary %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Net Emissions') %>%
select(all_of(col_order))
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5) # added NF3
processed_datasets <- list()
for(gas in config$gas_order){
cat_summary <- summary %>%
filter(category == gas) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_summary <- summary %>%
filter(category == sector) %>%
group_by(proj_name, year) %>%
summarise(value = sum(cat_sum),.groups='drop') %>%
group_by(year) %>%
mutate(low = min(value),
high = max(value)) %>%
select(year, low, high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_summary
}
summary_table_df <- bind_rows(processed_datasets)
summary_table_df$category <- ifelse(summary_table_df$category == 'IPPU', 'Industrial Processes', summary_table_df$category)
}
View(summary_table_df)
summary_table_df_high_low <- create_high_low_df(summary_table_df, config)
summary_table_df_high_low <- summary_table_df_high_low[order_index,]
View(summary_table_df_high_low)
col_order <- c('category','year','low','high')
summary <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj TODO
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
add_pct_change_05() %>%
select(!cat_sum)
summary_total_gross <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
filter(!category == 'LULUCF Sink') %>%
group_by(proj_name,year) %>%
summarise(cat_sum = sum(cat_sum),.groups='drop') %>%
mutate(pct_change_05 = (cat_sum/cat_sum[year==2005]-1)) %>%
mutate(pct_change_05 = round(pct_change_05,2)) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Gross Emissions') %>%
select(all_of(col_order))
summary_total_net <- projections_all_sm %>%
filter(!gas == 'Total') %>%  # WTH?? fix pls usproj
rename(category = .data[[category]]) %>%
filter(grouping == grouping) %>%
filter(year %in% config$table) %>%
group_by(proj_name,category, year) %>%
summarise(cat_sum = sum(sum),.groups='drop') %>%
group_by(proj_name,year) %>%
summarise(cat_sum = sum(cat_sum),.groups='drop') %>%
mutate(pct_change_05 = (cat_sum/cat_sum[year==2005]-1)) %>%
mutate(pct_change_05 = round(pct_change_05,2)) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = 'Total Net Emissions') %>%
select(all_of(col_order))
if(category == 'gas'){
order_index <- c(2,1,4,3,6,7,5)
processed_datasets <- list()
for(gas in config$gas_order){
cat_pct_change <- summary %>%
filter(category == gas) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = gas) %>%
select(all_of(col_order))
processed_datasets[[gas]] <- cat_pct_change
}
pct_change_table_df <- bind_rows(processed_datasets)
} else if(category == 'usproj_sector'){
processed_datasets <- list()
order_index <- c(2,5,3,1,5)
for(sector in config$sector_order){
cat_pct_change <- summary %>%
filter(category == sector) %>%
group_by(year) %>%
mutate(low = min(pct_change_05, na.rm=TRUE),
high = max(pct_change_05, na.rm=TRUE)) %>%
ungroup() %>%
select(year,low,high) %>%
distinct() %>%
mutate(category = sector) %>%
select(all_of(col_order))
processed_datasets[[sector]] <- cat_pct_change
}
pct_change_table_df <- bind_rows(processed_datasets)
pct_change_table_df$category <- ifelse(pct_change_table_df$category == 'IPPU', 'Industrial Processes', pct_change_table_df$category) # Change 'IPPU' to 'Industrial Processes'
}
View(pct_change_table_df)
gas_df <- create_summary_table('gas','wm', projections_all_sm, config)
sector_df <- create_summary_table('usproj_sector', 'wm', projections_all_sm, config)
gas_table <- create_html_table(gas_df, 'Gas',config)
gas_table
sector_table <- create_html_table(sector_df, 'Sector',config)
sector_table
tar_source()
gas_table <- create_html_table(gas_df, 'Gas',config)
gas_table
gas_df <- create_summary_table('gas','wm', projections_all_sm, config)
sector_df <- create_summary_table('usproj_sector', 'wm', projections_all_sm, config)
gas_table <- create_html_table(gas_df, 'Gas',config)
gas_table
sector_table <- create_html_table(sector_df, 'Sector',config)
sector_table
pct_change_table_gas <- create_pct_change_table('gas', 'wm', projections_all_sm, config)
pct_change_html_gas <- create_pct_change_html_table(pct_change_table_gas, 'Gas', config)
pct_change_html_gas
pct_change_table_sector <- create_pct_change_table('usproj_sector', 'wm', projections_all_sm, config)
pct_change_html_sector <- create_pct_change_html_table(pct_change_table_sector, 'Sector', config)
pct_change_html_sector
tar_make()
tar_invalidate(results_overview)
tar_make()
View(projections_ghgi)
View(projections_all_sm)
View(gas_breakout)
View(total_net_emissions)
